<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Mori - Mars Rost Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React och ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Sci-Fi Typsnitt -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            background-color: #0a0a0a; 
            margin: 0;
            overflow-x: hidden;
        }

        /* --- ANALYS STYLES --- */
        .analysis-bg {
            background-color: #030305;
            color: #e2e8f0;
            font-family: 'Rajdhani', sans-serif;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; letter-spacing: 1px; }
        
        .text-glow-green {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.6);
        }
        
        .text-glow-orange {
            color: #fbbf24;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.6);
        }

        .cyber-container {
            background: rgba(10, 10, 15, 0.85);
            border: 1px solid #1f2937;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            position: relative;
        }

        .info-alert {
            background: rgba(6, 78, 59, 0.2);
            border: 1px solid rgba(52, 211, 153, 0.3);
            border-left: 4px solid #34d399;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #334155;
            display: inline-block;
            padding: 10px 20px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .cyber-btn {
            background: transparent;
            border: 1px solid;
            padding: 6px 12px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            user-select: none;
            opacity: 0.7;
        }
        
        .cyber-btn:hover {
            box-shadow: 0 0 10px currentColor;
            background: rgba(255,255,255,0.05);
            opacity: 1;
        }
        
        .cyber-btn.active {
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 15px currentColor;
            border-color: currentColor;
            opacity: 1;
        }

        .btn-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background-color: currentColor;
            box-shadow: 0 0 5px currentColor;
        }

        .corner-accent {
            position: absolute;
            width: 12px; height: 12px;
            border: 2px solid;
            box-shadow: 0 0 8px currentColor;
        }
        .accent-swe { border-color: #4ade80; color: #4ade80; }
        .accent-world { border-color: #fbbf24; color: #fbbf24; }

        .top-left { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .top-right { top: -1px; right: -1px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: -1px; left: -1px; border-right: none; border-top: none; }
        .bottom-right { bottom: -1px; right: -1px; border-left: none; border-top: none; }

        /* Scrollbar Customization */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef, useCallback } = React;

        // --- IKONER ---
        const Clock = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        const Calendar = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        );
        const Sun = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>
        );
        const Activity = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        );
        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"/></svg>
        );
        const Coffee = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        );

        // --- APP LOGIK ---
        const App = () => {
            const [view, setView] = useState('memento'); 
            const [bYear, setBYear] = useState(1974);
            const [bMonth, setBMonth] = useState(12);
            const [bDay, setBDay] = useState(20);
            const [lifeExpectancy, setLifeExpectancy] = useState(83);
            const [sleepHours, setSleepHours] = useState(8);
            
            const TOTAL_YEARS = 100;
            const WEEKS_PER_YEAR = 52;

            const stats = useMemo(() => {
                const y = bYear || 1900;
                const m = (bMonth || 1) - 1;
                const d = bDay || 1;
                
                // Använd setFullYear för säker datumhantering
                const start = new Date();
                start.setFullYear(y, m, d);
                start.setHours(0,0,0,0);
                
                const now = new Date(); 
                
                // Fallback om datumet skulle bli ogiltigt
                if (isNaN(start.getTime())) return { yearsLived: 0, remainingDays: 0, percentage: "0.0", currentWeekIndex: 0, birthYear: bYear || 1900, birthWeekIndex: 0 };
                
                const currentYear = now.getFullYear();
                const birthYear = start.getFullYear();
                
                // ISO-Veckonummer
                const curD = new Date(now.getTime()); curD.setHours(0,0,0,0);
                curD.setDate(curD.getDate() + 4 - (curD.getDay() || 7));
                const yearStart = new Date(curD.getFullYear(), 0, 1);
                const currentWeekIndex = Math.ceil((((curD - yearStart) / 86400000) + 1) / 7) - 1;

                const birthD = new Date(start.getTime()); birthD.setHours(0,0,0,0);
                birthD.setDate(birthD.getDate() + 4 - (birthD.getDay() || 7));
                const birthYearStart = new Date(birthD.getFullYear(), 0, 1);
                const birthWeekIndex = Math.ceil((((birthD - birthYearStart) / 86400000) + 1) / 7) - 1;

                let actualAge = currentYear - birthYear;
                const mDiff = now.getMonth() - start.getMonth();
                if (mDiff < 0 || (mDiff === 0 && now.getDate() < start.getDate())) actualAge--;
                
                const totalWeeksLived = ((currentYear - birthYear) * WEEKS_PER_YEAR) + currentWeekIndex - birthWeekIndex;
                const totalWeeksExpectancy = (lifeExpectancy || 1) * WEEKS_PER_YEAR;
                const remainingDays = Math.floor(Math.max(0, totalWeeksExpectancy - totalWeeksLived) * 7);

                return {
                    birthYear,
                    currentYear,
                    currentWeekIndex,
                    birthWeekIndex,
                    percentage: totalWeeksExpectancy > 0 ? ((totalWeeksLived / totalWeeksExpectancy) * 100).toFixed(1) : "0.0",
                    yearsLived: actualAge,
                    remainingDays,
                    remainingWeeks: Math.floor(remainingDays / 7),
                    remainingYears: Math.max(0, (lifeExpectancy || 0) - actualAge),
                    remainingAwakeHours: Math.floor(remainingDays * (24 - sleepHours))
                };
            }, [bYear, bMonth, bDay, lifeExpectancy, sleepHours]);

            const getWeekStatus = (yearIndex, weekIndex) => {
                const rowYear = stats.birthYear + yearIndex;
                if (rowYear < stats.birthYear) return 'void';
                if (rowYear === stats.birthYear) {
                    if (weekIndex < stats.birthWeekIndex) return 'void';
                    if (rowYear < stats.currentYear) return 'lived';
                }
                if (rowYear > stats.birthYear && rowYear < stats.currentYear) return 'lived';
                if (rowYear === stats.currentYear) {
                    if (weekIndex < stats.currentWeekIndex) return 'lived';
                    if (weekIndex === stats.currentWeekIndex) return 'current';
                    return 'future';
                }
                const ageAtRow = rowYear - stats.birthYear;
                if (ageAtRow === lifeExpectancy) return 'expectancy'; 
                if (ageAtRow > lifeExpectancy) return 'bonus';
                return 'future';
            };

            // --- DATA GENERERING FÖR ANALYS ---
            const generateSwedenData = useCallback(() => {
                const ages = []; const deaths = []; const survivors = [];
                const heart = []; const cancer = []; const external = [];
                let population = 100000; const startPop = 100000;
                for (let age = 0; age <= 110; age++) {
                    ages.push(age);
                    let risk = 0.0002 + (0.00002 * Math.exp(0.108 * age));
                    if (age === 0) risk += 0.0020; 
                    if (age >= 15 && age <= 30) risk += 0.0004 * (1 - Math.abs(age - 22)/8);
                    if (risk > 1) risk = 1;
                    let dying = population * risk;
                    let deathRate = (dying / startPop) * 100;
                    let extShare = age < 15 ? 0.2 : (age < 40 ? 0.6 : 0.05);
                    external.push(deathRate * extShare);
                    let cancerShare = age < 30 ? 0 : (age < 50 ? 0.3 : (age < 80 ? 0.45 : 0.25));
                    cancer.push(deathRate * cancerShare);
                    let heartShare = age < 50 ? 0 : (age < 75 ? 0.3 : (age < 90 ? 0.5 : 0.65));
                    heart.push(deathRate * heartShare);
                    deaths.push(deathRate); survivors.push((population / startPop) * 100);
                    population -= dying;
                }
                return { ages, deaths, survivors, heart, cancer, external, maxDeath: Math.max(...deaths) };
            }, []);

            const generateGlobalData = useCallback(() => {
                const ages = []; const deaths = []; const survivors = [];
                const heart = []; const infection = []; const cancer = [];
                let population = 100000; const startPop = 100000;
                for (let age = 0; age <= 110; age++) {
                    ages.push(age);
                    let risk = 0.0015 + (0.000025 * Math.exp(0.106 * age));
                    if (age === 0) risk += 0.028; 
                    if (age > 0 && age <= 4) risk += 0.003; 
                    if (age >= 15 && age <= 29) risk += 0.0012;
                    if (risk > 1) risk = 1;
                    let dying = population * risk;
                    let deathRate = (dying / startPop) * 100;
                    let infShare = age <= 5 ? 0.6 : (age < 50 ? 0.25 : 0.1);
                    infection.push(deathRate * infShare);
                    let cancerShare = age < 40 ? 0.1 : 0.25;
                    cancer.push(deathRate * cancerShare);
                    let heartShare = age < 45 ? 0.1 : (age < 70 ? 0.35 : 0.5);
                    heart.push(deathRate * heartShare);
                    deaths.push(deathRate); survivors.push((population / startPop) * 100);
                    population -= dying;
                }
                return { ages, deaths, survivors, heart, infection, cancer, maxDeath: Math.max(...deaths) };
            }, []);

            // --- CHART LOGIK ---
            const chartRefs = useRef({});
            
            const renderAllCharts = useCallback(() => {
                const zonePlugin = {
                    id: 'zonePlugin',
                    afterDatasetsDraw: (chart) => {
                        const { ctx, chartArea: { top, bottom, right }, scales: { x } } = chart;
                        const isWorld = chart.canvas.id === 'globalChart';
                        const mainColor = isWorld ? '#fbbf24' : '#4ade80'; 
                        const glowColor = isWorld ? 'rgba(251, 191, 36, 0.4)' : 'rgba(74, 222, 128, 0.4)';
                        const phases = [
                            { start: 0, end: 12, label: 'BARNDOMEN' },
                            { start: 13, end: 19, label: 'UNGDOMEN' },
                            { start: 20, end: 39, label: 'VUXENLIVET' },
                            { start: 40, end: 64, label: 'MEDELÅLDERN' },
                            { start: 65, end: 110, label: 'ÅLDERDOMEN' }
                        ];
                        ctx.save(); ctx.textAlign = 'center'; ctx.font = 'bold 12px "Orbitron"';
                        phases.forEach((phase, idx) => {
                            const startX = x.getPixelForValue(phase.start);
                            let endX = x.getPixelForValue(phase.end);
                            if (phase.end >= 110) endX = right;
                            const centerX = startX + (endX - startX) / 2;
                            const textY = top + (idx % 2 === 0 ? 20 : 45);
                            ctx.fillStyle = "rgba(0,0,0,0.8)";
                            const tw = ctx.measureText(phase.label).width + 10;
                            ctx.fillRect(centerX - tw/2, textY - 8, tw, 16);
                            ctx.fillStyle = mainColor; ctx.fillText(phase.label, centerX, textY);
                            if (idx < phases.length - 1) {
                                const lx = x.getPixelForValue(phase.end + 0.5);
                                ctx.beginPath(); ctx.setLineDash([4,4]); ctx.moveTo(lx, top); ctx.lineTo(lx, bottom);
                                ctx.strokeStyle = glowColor; ctx.stroke();
                            }
                        });
                        ctx.restore();
                    }
                };

                const createConfig = (data, isWorld) => ({
                    type: 'bar',
                    data: {
                        labels: data.ages,
                        datasets: [
                            { type: 'line', label: 'ÖVERLEVANDE (%)', yAxisID: 'y_survivors', data: data.survivors, borderColor: '#06b6d4', borderWidth: 3, pointRadius: 0, tension: 0.4, fill: true, backgroundColor: 'rgba(6, 182, 212, 0.1)', order: 10 },
                            { type: 'bar', label: 'DÖDSFALL (TOTALT %)', yAxisID: 'y_deaths', data: data.deaths, backgroundColor: 'rgba(236, 72, 153, 0.8)', borderColor: '#ec4899', borderWidth: 1, barPercentage: 1.0, categoryPercentage: 1.0, order: 20 },
                            { type: 'line', label: 'Hjärt-Kärl', yAxisID: 'y_deaths', data: data.heart, borderColor: '#ef4444', borderWidth: 2, pointRadius: 0, tension: 0.4, hidden: true, order: 5 },
                            { type: 'line', label: isWorld ? 'Infektioner' : 'Cancer', yAxisID: 'y_deaths', data: isWorld ? data.infection : data.cancer, borderColor: isWorld ? '#c084fc' : '#facc15', borderWidth: 2, pointRadius: 0, tension: 0.4, hidden: true, order: 5 },
                            { type: 'line', label: isWorld ? 'Cancer' : 'Yttre Orsaker', yAxisID: 'y_deaths', data: isWorld ? data.cancer : data.external, borderColor: isWorld ? '#facc15' : '#60a5fa', borderWidth: 2, pointRadius: 0, tension: 0.4, hidden: true, order: 5 }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { color: '#1f2937' }, ticks: { color: '#94a3b8', font: { family: 'Rajdhani' }, callback: (v) => v % 10 === 0 ? v : '' } },
                            y_survivors: { type: 'linear', position: 'left', min: 0, max: 100, ticks: { color: '#06b6d4' } },
                            y_deaths: { type: 'linear', position: 'right', max: data.maxDeath * 1.2, ticks: { color: '#ec4899' } }
                        }
                    },
                    plugins: [zonePlugin]
                });

                if (chartRefs.current['swe']) chartRefs.current['swe'].destroy();
                if (chartRefs.current['world']) chartRefs.current['world'].destroy();

                chartRefs.current['swe'] = new Chart(document.getElementById('swedenChart'), createConfig(generateSwedenData(), false));
                chartRefs.current['world'] = new Chart(document.getElementById('globalChart'), createConfig(generateGlobalData(), true));
            }, [generateSwedenData, generateGlobalData]);

            useEffect(() => {
                if (view === 'analysis') {
                    const timer = setTimeout(() => {
                        renderAllCharts();
                    }, 100);
                    return () => clearTimeout(timer);
                }
            }, [view, renderAllCharts]);

            const toggleDataset = (chartId, index, e) => {
                const chart = chartRefs.current[chartId];
                if (!chart) return;
                const isVisible = chart.isDatasetVisible(index);
                chart.setDatasetVisibility(index, !isVisible);
                chart.update();
                e.currentTarget.classList.toggle('active');
            };

            // --- RENDERING ---
            if (view === 'analysis') {
                return (
                    <div className="min-h-screen p-4 md:p-8 analysis-bg relative">
                        <div className="max-w-7xl mx-auto space-y-12">
                            <div className="flex justify-between items-center mb-8">
                                <div className="text-left">
                                    <h1 className="text-4xl md:text-6xl font-black text-white uppercase tracking-widest orbitron">Mortalitets Analys</h1>
                                    <p className="text-gray-500 font-mono text-sm uppercase">Jämförelse: Nationell vs Global Data</p>
                                </div>
                                <button onClick={() => setView('memento')} className="px-6 py-2 border border-zinc-800 hover:border-orange-500 text-zinc-500 hover:text-orange-500 transition-all orbitron text-xs flex items-center gap-2">
                                    <ChevronLeft size={16} /> TILLBAKA
                                </button>
                            </div>

                            <div className="cyber-container info-alert p-4 rounded-lg mb-6 max-w-4xl mx-auto">
                                <h3 className="text-lg font-bold text-green-400 mb-1 flex items-center gap-2 orbitron">ℹ️ SYSTEM NOTERING: STARTEN AV LIVET</h3>
                                <p className="text-gray-300 text-sm leading-relaxed">
                                    <strong className="text-green-300">Varför 100%?</strong> Linjen startar på 100% eftersom den representerar födelsekullen vid födelseögonblicket (0 år). <br/>
                                    <strong className="text-green-300">Varför en stapel direkt?</strong> Den rosa stapeln vid 0 år visar <em>spädbarnsdödlighet</em>. Trots att vi är nya är det första levnadsåret biologiskt skört.
                                </p>
                            </div>

                            <section>
                                <div className="flex items-center gap-4 mb-4">
                                    <div className="h-px flex-1 bg-gradient-to-r from-transparent to-green-500"></div>
                                    <h2 className="text-2xl md:text-3xl font-bold text-glow-green uppercase orbitron">Sverige (Höginkomst)</h2>
                                    <div className="h-px flex-1 bg-gradient-to-l from-transparent to-green-500"></div>
                                </div>
                                <div className="cyber-container p-6 rounded-xl border-t-2 border-green-500">
                                    <div className="corner-accent accent-swe top-left" /><div className="corner-accent accent-swe top-right" />
                                    <div className="corner-accent accent-swe bottom-left" /><div className="corner-accent accent-swe bottom-right" />
                                    <div className="flex flex-wrap gap-3 mb-6 justify-end border-b border-green-900/50 pb-4">
                                        <span className="text-xs font-mono text-green-600 self-center mr-auto">DATABANK // KONTROLL</span>
                                        <button className="cyber-btn active text-cyan-400 border-cyan-400/50" onClick={(e) => toggleDataset('swe', 0, e)}><div className="btn-dot"/>Överlevande</button>
                                        <button className="cyber-btn active text-pink-500 border-pink-500/50" onClick={(e) => toggleDataset('swe', 1, e)}><div className="btn-dot"/>Dödsfall</button>
                                        <div className="w-px bg-green-900/50 mx-2" />
                                        <button className="cyber-btn text-red-500 border-red-500/50" onClick={(e) => toggleDataset('swe', 2, e)}><div className="btn-dot"/>Hjärt-Kärl</button>
                                        <button className="cyber-btn text-yellow-400 border-yellow-400/50" onClick={(e) => toggleDataset('swe', 3, e)}><div className="btn-dot"/>Cancer</button>
                                        <button className="cyber-btn text-blue-400 border-blue-400/50" onClick={(e) => toggleDataset('swe', 4, e)}><div className="btn-dot"/>Yttre Orsaker</button>
                                    </div>
                                    <div className="h-[400px] w-full"><canvas id="swedenChart" /></div>
                                    <div className="text-center mt-6"><div className="stat-box text-green-400 border-green-500/50 shadow-[0_0_15px_rgba(74,222,128,0.3)] orbitron">MEDELLIVSLÄNGD: ~83 ÅR</div></div>
                                </div>
                            </section>

                            <section>
                                <div className="flex items-center gap-4 mb-4">
                                    <div className="h-px flex-1 bg-gradient-to-r from-transparent to-amber-500"></div>
                                    <h2 className="text-2xl md:text-3xl font-bold text-glow-orange uppercase orbitron">Världen (Globalt Snitt)</h2>
                                    <div className="h-px flex-1 bg-gradient-to-l from-transparent to-amber-500"></div>
                                </div>
                                <div className="cyber-container p-6 rounded-xl border-t-2 border-amber-500">
                                    <div className="corner-accent accent-world top-left" /><div className="corner-accent accent-world top-right" />
                                    <div className="corner-accent accent-world bottom-left" /><div className="corner-accent accent-world bottom-right" />
                                    <div className="flex flex-wrap gap-3 mb-6 justify-end border-b border-amber-900/50 pb-4">
                                        <span className="text-xs font-mono text-amber-600 self-center mr-auto">DATABANK // KONTROLL</span>
                                        <button className="cyber-btn active text-cyan-400 border-cyan-400/50" onClick={(e) => toggleDataset('world', 0, e)}><div className="btn-dot"/>Överlevande</button>
                                        <button className="cyber-btn active text-pink-500 border-pink-500/50" onClick={(e) => toggleDataset('world', 1, e)}><div className="btn-dot"/>Dödsfall</button>
                                        <div className="w-px bg-amber-900/50 mx-2" />
                                        <button className="cyber-btn text-red-500 border-red-500/50" onClick={(e) => toggleDataset('world', 2, e)}><div className="btn-dot"/>Hjärt-Kärl</button>
                                        <button className="cyber-btn text-purple-400 border-purple-400/50" onClick={(e) => toggleDataset('world', 3, e)}><div className="btn-dot"/>Infektioner</button>
                                        <button className="cyber-btn text-yellow-400 border-yellow-400/50" onClick={(e) => toggleDataset('world', 4, e)}><div className="btn-dot"/>Cancer</button>
                                    </div>
                                    <div className="h-[400px] w-full"><canvas id="globalChart" /></div>
                                    <div className="text-center mt-6"><div className="stat-box text-amber-400 border-amber-500/50 shadow-[0_0_15px_rgba(251,191,36,0.3)] orbitron">MEDELLIVSLÄNGD: ~73 ÅR</div></div>
                                </div>
                            </section>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pt-8 border-t border-gray-800">
                                <div className="cyber-container p-6 border-l-4 border-cyan-400 rounded-r-xl">
                                    <h3 className="text-xl font-bold text-cyan-400 mb-2 orbitron">ÖVERLEVANDE (Vänster Axel)</h3>
                                    <p className="text-gray-400 text-sm leading-relaxed">Den <span className="text-cyan-400 font-bold">CYANFÄRGADE</span> linjen visar hur många procent som lever kvar. Kurvan ligger högt och stabilt genom hela uppväxten men dyker brant nedåt när Medelåldern tar slut.</p>
                                </div>
                                <div className="cyber-container p-6 border-l-4 border-pink-500 rounded-r-xl">
                                    <h3 className="text-xl font-bold text-pink-500 mb-2 orbitron">DÖDSFALL (Höger Axel)</h3>
                                    <p className="text-gray-400 text-sm leading-relaxed">De <span className="text-pink-500 font-bold">ROSA</span> staplarna visar risken att dö. Observera "Ungdomspuckeln" runt 20 år och den massiva toppen ("Peaken") djupt in i Ålderdomen.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- HUVUDVY (Memento Mori) ---
            return (
                <div className="min-h-screen bg-[#0a0a0a] text-zinc-300 font-sans p-4 md:p-8 flex flex-col items-center selection:bg-orange-900 selection:text-orange-100">
                    <header className="w-full max-w-5xl mb-12 flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-b border-zinc-800 pb-6">
                        <div>
                            <h1 className="text-3xl md:text-5xl font-thin tracking-tight text-zinc-100 mb-2 font-mono">MEMENTO <span className="text-orange-500 font-bold">MORI</span></h1>
                            <p className="text-zinc-500 text-sm max-w-md font-mono uppercase tracking-widest">System Status: <span className="text-orange-500">Active</span> // KALENDERÅR</p>
                        </div>
                        <div className="flex gap-6 font-mono text-sm flex-wrap md:flex-nowrap">
                            <div className="flex flex-col gap-1">
                                <label className="text-[10px] uppercase text-zinc-600 font-bold">Födelsedatum</label>
                                <div className="flex gap-2">
                                    <input type="number" value={bYear || ''} onChange={(e) => setBYear(parseInt(e.target.value) || 0)} className="w-20 bg-zinc-900 border border-zinc-800 text-orange-500 px-2 py-2 rounded focus:outline-none focus:border-orange-500/50 text-center" />
                                    <input type="number" value={bMonth || ''} onChange={(e) => setBMonth(Math.min(12, Math.max(1, parseInt(e.target.value) || 0)))} className="w-12 bg-zinc-900 border border-zinc-800 text-orange-500 px-2 py-2 rounded focus:outline-none focus:border-orange-500/50 text-center" />
                                    <input type="number" value={bDay || ''} onChange={(e) => setBDay(Math.min(31, Math.max(1, parseInt(e.target.value) || 0)))} className="w-12 bg-zinc-900 border border-zinc-800 text-orange-500 px-2 py-2 rounded focus:outline-none focus:border-orange-500/50 text-center" />
                                </div>
                            </div>
                            <div className="flex flex-col gap-1">
                                <label className="text-[10px] uppercase text-zinc-600 font-bold">Medellivslängd</label>
                                <div className="flex items-center gap-2 pt-2">
                                    <input type="range" min="70" max="100" value={lifeExpectancy} onChange={(e) => setLifeExpectancy(parseInt(e.target.value))} className="w-24 accent-orange-500" />
                                    <span className="text-orange-500 text-xs">{lifeExpectancy} år</span>
                                </div>
                            </div>
                            <div className="flex flex-col gap-1">
                                <label className="text-[10px] uppercase text-zinc-600 font-bold">Sömn (h/natt)</label>
                                <div className="flex items-center gap-2 pt-2">
                                    <input type="range" min="0" max="24" step="1" value={sleepHours} onChange={(e) => setSleepHours(parseInt(e.target.value) || 0)} className="w-24 accent-orange-500" />
                                    <span className="text-orange-500 text-xs">{sleepHours} h</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="w-full max-w-5xl grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                        <div className="bg-zinc-900/50 p-4 border border-zinc-800/50 backdrop-blur-sm group hover:border-orange-500/30 transition-all">
                            <div className="text-[10px] uppercase tracking-widest text-zinc-600 mb-2">Ålder</div>
                            <div className="text-3xl font-mono text-zinc-100">{stats.yearsLived}</div>
                        </div>
                        <div className="bg-zinc-900/50 p-4 border border-zinc-800/50 backdrop-blur-sm group hover:border-orange-500/30 transition-all">
                            <div className="text-[10px] uppercase tracking-widest text-zinc-600 mb-2">Vecka</div>
                            <div className="text-3xl font-mono text-zinc-100">{stats.currentWeekIndex + 1}<span className="text-sm text-zinc-600">/52</span></div>
                        </div>
                        <div className="bg-zinc-900/50 p-4 border border-zinc-800/50 backdrop-blur-sm group hover:border-orange-500/30 transition-all">
                            <div className="text-[10px] uppercase tracking-widest text-zinc-600 mb-2">Dagar kvar</div>
                            <div className="text-3xl font-mono text-zinc-100">{stats.remainingDays.toLocaleString()}</div>
                        </div>
                        <div className="bg-zinc-900/50 p-4 border border-zinc-800/50 backdrop-blur-sm group hover:border-orange-500/30 transition-all">
                            <div className="text-[10px] uppercase tracking-widest text-zinc-600 mb-2">Progress</div>
                            <div className="text-3xl font-mono text-orange-500">{stats.percentage}%</div>
                        </div>
                    </div>

                    <div className="w-full max-w-5xl mb-12">
                        <h3 className="text-[10px] uppercase tracking-widest text-zinc-600 font-mono mb-3 flex items-center gap-2">
                            <Activity size={10} className="text-orange-500" /> Perspective // Resurser kvar
                        </h3>
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div className="bg-zinc-900/30 p-4 border border-zinc-800/30 flex items-center gap-4">
                                <div className="p-2 bg-zinc-800 rounded-full text-orange-500/80"><Clock size={16} /></div>
                                <div><div className="text-xl font-mono text-zinc-200">{stats.remainingDays.toLocaleString()}</div><div className="text-[10px] uppercase tracking-widest text-zinc-600">Dagar</div></div>
                            </div>
                            <div className="bg-zinc-900/30 p-4 border border-zinc-800/30 flex items-center gap-4 border-orange-500/20">
                                <div className="p-2 bg-zinc-800 rounded-full text-orange-500/80"><Coffee size={16} /></div>
                                <div><div className="text-xl font-mono text-orange-500">{stats.remainingAwakeHours.toLocaleString()}</div><div className="text-[10px] uppercase tracking-widest text-zinc-600">Vakna h</div></div>
                            </div>
                            <div className="bg-zinc-900/30 p-4 border border-zinc-800/30 flex items-center gap-4">
                                <div className="p-2 bg-zinc-800 rounded-full text-orange-500/80"><Calendar size={16} /></div>
                                <div><div className="text-xl font-mono text-zinc-200">{stats.remainingWeeks.toLocaleString()}</div><div className="text-[10px] uppercase tracking-widest text-zinc-600">Helger</div></div>
                            </div>
                            <div className="bg-zinc-900/30 p-4 border border-zinc-800/30 flex items-center gap-4">
                                <div className="p-2 bg-zinc-800 rounded-full text-orange-500/80"><Sun size={16} /></div>
                                <div><div className="text-xl font-mono text-zinc-200">{stats.remainingYears}</div><div className="text-[10px] uppercase tracking-widest text-zinc-600">Somrar</div></div>
                            </div>
                        </div>
                    </div>

                    <div className="w-full max-w-5xl bg-[#0f0f0f] p-4 md:p-10 rounded-xl shadow-2xl border border-zinc-800/50 overflow-x-auto relative mb-12">
                        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_50%_0%,rgba(249,115,22,0.03),transparent_70%)] pointer-events-none" />
                        <div className="min-w-[700px] flex flex-col items-start gap-[2px]">
                            {Array.from({ length: TOTAL_YEARS }).map((_, yearIndex) => {
                                const rowYear = stats.birthYear + yearIndex;
                                const isCurrent = rowYear === stats.currentYear;
                                return (
                                    <div key={yearIndex} className={`flex items-center gap-3 w-full transition-all duration-500 ${isCurrent ? 'my-6 py-4 bg-zinc-900/30 border-y border-orange-500/20 scale-[1.02] shadow-[0_0_30px_rgba(0,0,0,0.5)]' : 'opacity-80 hover:opacity-100 hover:bg-zinc-900/40'}`}>
                                        <div className={`w-12 text-right font-mono flex justify-end items-center gap-2 shrink-0 ${isCurrent ? 'text-orange-500 font-bold text-lg' : 'text-[10px] text-zinc-700'}`}>
                                            <span>{rowYear}</span>
                                            {(yearIndex % 10 === 0 || isCurrent) && (
                                                <span className={`${isCurrent ? 'text-sm text-orange-500/50' : 'text-[8px] text-zinc-800'}`}>
                                                    {isCurrent ? stats.yearsLived : yearIndex}
                                                </span>
                                            )}
                                        </div>
                                        <div className="flex gap-[2px] flex-1">
                                            {Array.from({ length: WEEKS_PER_YEAR }).map((_, weekIndex) => {
                                                const status = getWeekStatus(yearIndex, weekIndex);
                                                let size = isCurrent ? "w-2 h-4 md:w-3 md:h-8" : "w-2 h-2 md:w-3 md:h-3";
                                                let color = "bg-zinc-900 border border-zinc-800/60";
                                                if (status === 'lived') color = "bg-orange-900/60 border border-orange-700/50";
                                                if (status === 'current') color = "bg-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.8)] animate-pulse border border-orange-400 scale-110 z-10";
                                                if (status === 'expectancy') color = "bg-zinc-800 border border-orange-900/30";
                                                if (status === 'void') color = "bg-transparent border border-zinc-800/20";
                                                return <div key={weekIndex} className={`${size} ${color} rounded-[1px] transition-all`} title={`${rowYear}, V${weekIndex + 1}`} />;
                                            })}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="w-full max-w-5xl mb-12">
                        <button onClick={() => setView('analysis')} className="w-full py-4 border border-orange-500/30 bg-orange-500/5 hover:bg-orange-500/10 transition-all rounded-lg font-mono text-sm tracking-[0.2em] text-orange-500 group flex items-center justify-center gap-3">
                            <Activity size={16} className="group-hover:animate-pulse" /> MORTALITETSANALYS
                        </button>
                    </div>
                    
                    <footer className="mt-8 text-zinc-700 text-[10px] font-mono text-center max-w-2xl border-t border-zinc-900 pt-8 uppercase tracking-widest">
                        <p>Tid är den enda valuta du inte kan spara.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>